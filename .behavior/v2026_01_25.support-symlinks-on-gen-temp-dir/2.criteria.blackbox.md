# usecase.1 = create symlinks to repo root files from temp dir

## definitions
- `at` = relative path within the temp-dir's cwd (where the symlink is created)
- `to` = relative path within the repo-root's cwd (what the symlink points to)

given('genTempDir is called with symlink option')
  when('symlink array contains valid entries')
    then('symlink is created at `{tempDir}/{at}`')
    then('symlink points to `{repoRoot}/{to}`')
      sothat('changes to repo root files are reflected in temp dir without copy')
    then('symlink target is resolved relative to repo root, not process.cwd()')
      sothat('tests work regardless of where npm test is invoked from')

  when('symlink `at` path includes nested directories')
    then('parent directories are created automatically')
      sothat('users dont need to pre-create directory structure')

  when('symlink `to` path points to a directory')
    then('a directory symlink is created')
      sothat('entire directory trees can be linked')

  when('symlink `to` path points to a file')
    then('a file symlink is created')
      sothat('individual files can be linked')


# usecase.2 = combine symlinks with fixture clone

given('genTempDir is called with both clone and symlink options')
  when('fixture is cloned and symlinks are specified')
    then('fixture contents are cloned first')
    then('symlinks are created after clone completes')
      sothat('symlinks can reference or augment cloned fixture content')


# usecase.3 = handle symlink errors gracefully

given('genTempDir is called with symlink option')
  when('`{repoRoot}/{to}` does not exist')
    then('throws a clear error that specifies the absent target path')
      sothat('users know which symlink target is invalid')

  when('`{tempDir}/{at}` would overwrite a prior file from clone')
    then('throws a clear error about the conflict')
      sothat('users are aware of path collision between clone and symlink')


# usecase.4 = multiple symlinks in single call

given('genTempDir is called with multiple symlink entries')
  when('all entries are valid')
    then('all symlinks are created')
      sothat('users can link multiple repo root paths in one call')

  when('one entry has an invalid target')
    then('operation fails before it creates any symlinks')
      sothat('temp dir is not left in partial state')
