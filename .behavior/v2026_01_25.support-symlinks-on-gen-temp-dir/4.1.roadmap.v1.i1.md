# roadmap: genTempDir symlink support

## phase.0 = baseline verification

**depends on:** nothing

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.3.blueprint.v1.i1.md`

### checklist

- [ ] verify baseline tests pass

### acceptance criteria

```
given('baseline codebase')
  when('npm run test:types && npm run test:unit && npm run test:integration')
    then('all tests pass')
    then('no type errors')
```

### verification

```sh
npm run test:types && npm run test:unit && npm run test:integration
```

---

## phase.1 = create infra utility `createSymlinks.ts`

**depends on:** phase.0

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.3.blueprint.v1.i1.md` — contracts section
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.1.research.patterns._.code.prod.v1.i1.md` — pattern.3 (cloneFixture), pattern.4 (error handle)

### checklist

- [ ] create `src/infra/isomorph.fs/createSymlinks.ts`
- [ ] implement validation: all targets exist (fail-fast)
- [ ] implement validation: no path collisions
- [ ] implement parent directory creation
- [ ] implement symlink creation via `fs.symlinkSync`
- [ ] use `BadRequestError` for invalid inputs

### acceptance criteria

```
given('createSymlinks module')
  when('imported')
    then('exports createSymlinks function')
    then('function accepts { symlinks, tempDir, gitRoot }')

given('createSymlinks is called')
  when('target does not exist')
    then('throws BadRequestError with target path in message')

  when('path collision detected')
    then('throws BadRequestError with collision path in message')
```

### verification

```sh
npm run test:types
```

---

## phase.2 = create unit tests for `createSymlinks`

**depends on:** phase.1

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.3.blueprint.v1.i1.md` — test coverage section

### checklist

- [ ] create `src/infra/isomorph.fs/createSymlinks.test.ts`
- [ ] test: symlinks created at specified paths
- [ ] test: symlinks point to correct targets
- [ ] test: parent directories created for nested `at` paths
- [ ] test: throws BadRequestError when target absent
- [ ] test: throws BadRequestError on path collision
- [ ] test: multiple symlinks all created
- [ ] test: all-or-none semantics (no partial creation on error)

### acceptance criteria

```
given('createSymlinks unit tests')
  when('npm run test:unit -- createSymlinks')
    then('all tests pass')
    then('covers happy path (symlinks created)')
    then('covers error path (target absent)')
    then('covers error path (collision)')
    then('covers all-or-none semantics')
```

### verification

```sh
npm run test:unit -- createSymlinks
```

---

## phase.3 = extend `genTempDir.ts`

**depends on:** phase.2

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.3.blueprint.v1.i1.md` — contracts section, execution order section
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.1.research.patterns._.code.prod.v1.i1.md` — pattern.1 (genTempDir orchestration)

### checklist

- [ ] extend input type: add `symlink?: Array<{ at: string; to: string }>`
- [ ] import `createSymlinks` from infra layer
- [ ] call `createSymlinks` after clone (if symlink array provided)
- [ ] pass `gitRoot` and `tempDir` to `createSymlinks`

### acceptance criteria

```
given('genTempDir module')
  when('called with symlink option')
    then('accepts symlink array without type error')
    then('calls createSymlinks after clone')

given('genTempDir with symlink')
  when('symlink targets exist')
    then('returns temp dir path')
    then('temp dir contains symlinks')
```

### verification

```sh
npm run test:types
npm run test:unit -- genTempDir
```

---

## phase.4 = extend integration tests

**depends on:** phase.3

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/2.criteria.blackbox.md` — all usecases
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.3.blueprint.v1.i1.md` — test coverage section

### checklist

- [ ] extend `src/domain.operations/genTempDir/genTempDir.integration.jest.test.ts`
- [ ] test: symlink to file in repo root
- [ ] test: symlink to directory in repo root
- [ ] test: symlinked files are readable
- [ ] test: symlinks work alongside clone
- [ ] test: error on absent target
- [ ] test: nested `at` paths (parent dirs created)

### acceptance criteria

```
given('genTempDir integration tests')
  when('npm run test:integration -- genTempDir')
    then('all tests pass')
    then('covers usecase.1: create symlinks to repo root')
    then('covers usecase.2: combine symlinks with clone')
    then('covers usecase.3: error on absent target')
    then('covers usecase.4: multiple symlinks')
```

### verification

```sh
npm run test:integration -- genTempDir
```

---

## phase.5 = update readme documentation

**depends on:** phase.4

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/3.3.blueprint.v1.i1.md` — documentation section

### checklist

- [ ] locate genTempDir section in `readme.md`
- [ ] add "with symlinks to repo root" subsection
- [ ] add usage example with `symlink` option
- [ ] document `at` and `to` option definitions
- [ ] document behavior notes (after clone, auto-create dirs, error on absent)

### acceptance criteria

```
given('readme.md')
  when('reviewed')
    then('contains symlink usage example')
    then('documents `at` option (relative path within temp dir)')
    then('documents `to` option (relative path within repo root)')
    then('documents error behavior')
```

### verification

```sh
# manual review
cat readme.md | grep -A 30 "symlink"
```

---

## phase.6 = final verification

**depends on:** phase.5

**read before:**
- `.behavior/v2026_01_25.support-symlinks-on-gen-temp-dir/2.criteria.blackbox.md` — all usecases

### checklist

- [ ] all unit tests pass
- [ ] all integration tests pass
- [ ] no type errors
- [ ] readme documentation complete
- [ ] all blackbox criteria satisfied

### acceptance criteria

```
given('complete implementation')
  when('full test suite runs')
    then('npm run test:types passes')
    then('npm run test:unit passes')
    then('npm run test:integration passes')

given('blackbox criteria')
  then('usecase.1 satisfied: symlinks created at {tempDir}/{at}')
  then('usecase.2 satisfied: symlinks work with clone')
  then('usecase.3 satisfied: clear error on absent target')
  then('usecase.4 satisfied: multiple symlinks in single call')
```

### verification

```sh
npm run test:types && npm run test:unit && npm run test:integration
```

---

## dependency graph

```
phase.0 (baseline)
    │
    ▼
phase.1 (createSymlinks.ts)
    │
    ▼
phase.2 (createSymlinks.test.ts)
    │
    ▼
phase.3 (genTempDir.ts)
    │
    ▼
phase.4 (integration tests)
    │
    ▼
phase.5 (readme.md)
    │
    ▼
phase.6 (final verification)
```

---

## summary

| phase | deliverable | verification |
|-------|-------------|--------------|
| 0 | baseline passes | `npm run test:types && test:unit && test:integration` |
| 1 | `createSymlinks.ts` | `npm run test:types` |
| 2 | `createSymlinks.test.ts` | `npm run test:unit -- createSymlinks` |
| 3 | `genTempDir.ts` extended | `npm run test:types && test:unit -- genTempDir` |
| 4 | integration tests extended | `npm run test:integration -- genTempDir` |
| 5 | `readme.md` updated | manual review |
| 6 | all criteria satisfied | full test suite |
