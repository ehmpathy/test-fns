# execution: genTempDir symlink support

## phase.0 = baseline verification

- [x] verify baseline tests pass

### log

```
✅ npm run test:types - passed (no type errors)
✅ npm run test:unit - 10 suites, 89 passed (13 skipped, 1 todo)
✅ npm run test:integration - 2 suites, 14 passed
```

---

## phase.1 = create infra utility `createSymlinks.ts`

- [x] create `src/infra/isomorph.fs/createSymlinks.ts`
- [x] implement validation: all targets exist (fail-fast)
- [x] implement validation: no path collisions
- [x] implement parent directory creation
- [x] implement symlink creation via `fs.symlinkSync`
- [x] use `BadRequestError` for invalid inputs

### log

```
✅ created src/infra/isomorph.fs/createSymlinks.ts
✅ npm run test:types - passed
```

---

## phase.2 = create unit tests for `createSymlinks`

- [x] create `src/infra/isomorph.fs/createSymlinks.jest.test.ts`
- [x] test: symlinks created at specified paths
- [x] test: symlinks point to correct targets
- [x] test: parent directories created for nested `at` paths
- [x] test: throws BadRequestError when target absent
- [x] test: throws BadRequestError on path collision
- [x] test: multiple symlinks all created
- [x] test: all-or-none semantics (no partial creation on error)

### log

```
✅ created src/infra/isomorph.fs/createSymlinks.jest.test.ts
✅ npm run test:unit -- createSymlinks: 8 tests passed
```

---

## phase.3 = extend `genTempDir.ts`

- [x] extend input type: add `symlink?: Array<{ at: string; to: string }>`
- [x] import `createSymlinks` from infra layer
- [x] call `createSymlinks` after clone (if symlink array provided)
- [x] pass `gitRoot` and `tempDir` to `createSymlinks`

### log

```
✅ extended genTempDir.ts with symlink support
✅ npm run test:types - passed
✅ npm run test:unit -- genTempDir: all tests passed
```

---

## phase.4 = extend integration tests

- [x] extend `src/domain.operations/genTempDir/genTempDir.integration.jest.test.ts`
- [x] test: symlink to file in repo root
- [x] test: symlink to directory in repo root
- [x] test: symlinked files are readable
- [x] test: symlinks work alongside clone
- [x] test: error on absent target
- [x] test: nested `at` paths (parent dirs created)

### log

```
✅ extended genTempDir.integration.jest.test.ts with 7 symlink test cases
✅ npm run test:integration -- genTempDir: 21 tests passed
```

---

## phase.5 = update readme documentation

- [x] locate genTempDir section in `readme.md`
- [x] add "with symlinks to repo root" subsection
- [x] add usage example with `symlink` option
- [x] document `at` and `to` option definitions
- [x] document behavior notes (after clone, auto-create dirs, error on absent)

### log

```
✅ added "with symlinks to repo root" subsection to readme.md
✅ documented symlink options (at, to)
✅ documented behavior notes
```

---

## phase.6 = final verification

- [x] all unit tests pass
- [x] all integration tests pass
- [x] no type errors
- [x] readme documentation complete
- [x] all blackbox criteria satisfied

### log

```
✅ npm run test:types - passed (no type errors)
✅ npm run test:unit - 97 passed (13 skipped, 1 todo)
✅ npm run test:integration - 21 passed
✅ readme.md updated with symlink documentation

blackbox criteria verification:
✅ usecase.1 - symlinks created at {tempDir}/{at} that reference {repoRoot}/{to}
✅ usecase.1 - symlink target resolved relative to repo root
✅ usecase.1 - parent directories created automatically for nested at paths
✅ usecase.1 - directory symlinks work
✅ usecase.1 - file symlinks work
✅ usecase.2 - clone happens before symlinks
✅ usecase.2 - symlinks augment cloned content
✅ usecase.3 - throws BadRequestError for absent target
✅ usecase.3 - throws BadRequestError for path collision
✅ usecase.4 - multiple symlinks all created
✅ usecase.4 - all-or-none semantics (no partial creation)
```
