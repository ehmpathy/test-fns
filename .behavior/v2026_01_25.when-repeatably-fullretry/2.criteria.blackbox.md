# blackbox criteria: repeatably with criteria 'SOME'

## core model

```ts
given('repeatably with criteria SOME')
  then('N describe blocks are registered (same as EVERY)')
  then('each describe block contains identical tests')
  then('the ONLY difference: if a prior attempt passed, skip subsequent attempts entirely')
```

## usecase.1 = when.repeatably registers N identical when blocks

```ts
given('when.repeatably({ attempts: 3, criteria: "SOME" })')
  when('test file loads')
    then('3 describe blocks are registered')
    then('each named: "when: description, attempt N"')
    then('each contains identical then blocks')

  when('attempt 1 passes')
    then('attempt 1: all* hooks run, all tests run and pass')
    then('attempt 2: all* hooks SKIPPED, all tests SKIPPED')
    then('attempt 3: all* hooks SKIPPED, all tests SKIPPED')

  when('attempt 1 fails, attempt 2 passes')
    then('attempt 1: all* hooks run, all tests run and fail')
    then('attempt 2: all* hooks run, all tests run and pass')
    then('attempt 3: all* hooks SKIPPED, all tests SKIPPED')

  when('all attempts fail')
    then('attempt 1: all* hooks run, all tests run and fail')
    then('attempt 2: all* hooks run, all tests run and fail')
    then('attempt 3: all* hooks run, all tests run and fail')
```

## usecase.2 = given.repeatably registers N identical given blocks

```ts
given('given.repeatably({ attempts: 3, criteria: "SOME" })')
  when('test file loads')
    then('3 describe blocks are registered')
    then('each named: "given: description, attempt N"')
    then('each contains identical when/then blocks')

  when('attempt 1 passes')
    then('attempt 1: all* hooks run, all tests run and pass')
    then('attempt 2: all* hooks SKIPPED, all tests SKIPPED')
    then('attempt 3: all* hooks SKIPPED, all tests SKIPPED')

  when('attempt 1 fails, attempt 2 passes')
    then('attempt 1: all* hooks run, all tests run and fail')
    then('attempt 2: all* hooks run, all tests run and pass')
    then('attempt 3: all* hooks SKIPPED, all tests SKIPPED')

  when('all attempts fail')
    then('attempt 1: all* hooks run, all tests run and fail')
    then('attempt 2: all* hooks run, all tests run and fail')
    then('attempt 3: all* hooks run, all tests run and fail')
```

## usecase.3 = skip behavior applies to all* hooks and tests

```ts
given('a prior attempt already passed')
  when('subsequent attempt would run')
    then('useBeforeAll callbacks: SKIPPED')
    then('useAfterAll callbacks: SKIPPED')
    then('useThen callbacks: SKIPPED')
    then('then test callbacks: SKIPPED')
    then('expensive operations do NOT execute')
```

note: `all*` = all skippable hooks; `beforeAll` and `afterAll` are not supported

## usecase.4 = framework compatibility

```ts
given('vitest user')
  then('vitest is optional peerDependency: ">=3.1.0"')
  then('user with vitest <3.1.0 is warned by npm on install')
  then('user without vitest is not warned')

given('jest user')
  then('jest is optional peerDependency')
  then('user without jest is not warned')
```

## usecase.5 = test output reflects skip state

```ts
given('repeatably execution completes')
  when('user views test output')
    then('passed attempts show checkmarks')
    then('skipped attempts show skip markers')
    then('failed attempts show failure markers')
    then('each attempt clearly labeled with attempt number')
```

## edge cases

```ts
given('attempts = 1')
  then('1 describe block registered')
  then('behaves like normal given/when block')
  then('no skip logic applies (no subsequent attempts exist)')

given('nested repeatably blocks')
  when('given.repeatably contains when.repeatably')
    then('each level tracks its own success state')
    then('inner success does not affect outer skip logic')
    then('outer success skips entire inner repeatably block')

given('mixed pass/fail within single attempt')
  when('some then blocks pass, some fail')
    then('attempt is marked as FAILED')
    then('subsequent attempts are NOT skipped')
```
